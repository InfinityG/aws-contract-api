module.exports = Deployer;

var Promise = require('bluebird'); // available from parent's modules
var ApiGatewayApi = require('./aws/api_gateway_api');
var debug = require('debug')('Deployer'); // available from parent's modules


function Deployer(config, api) {

  var apigw = new ApiGatewayApi(config);

  var found; // api already exists

  return new Promise(function(resolve, reject) {

    /*
     * 1. Get the list of APIs to determine if the api being deployed
     *    already exists.
     */

    debug('get api list');

    apigw.getRestApis().then(function(APIs) {

      APIs.forEach(function(item) {

        debug('found api id:\'%s\', name\'%s\', description\'%s\'', 
          item.id, item.name, item.description);

        if (item.name == api.name) found = api;

      });

    })

    .then(function() {

      if (found) {
        debug('updating api name:\'%s\'', found.name);
        return;
      }

      debug('creating api name:\'%s\'', api.name);

    })

    .catch(reject)

  });
  
}
